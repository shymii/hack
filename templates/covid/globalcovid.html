{% extends 'base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href='{% static "style/css/globalcovid.css" %}'>
{% endblock css %}

{% block content %}
    <h2>Globalne statystyki</h2>
    <section class="globalCharts">
        <canvas id="myChart"></canvas>
        <p id="casesRes">

        </p>
        <section class="smallchart">
            <canvas id="dailyChart"></canvas>
        </section>
        <section class="desc">
            <p>Wykres dziennych przypadków</p>
            <p id="dailyRes">

            </p>
        </section>
        <section class="desc">
            <p id="deathRes">

            </p>
            <p id="recoveredRes">

            </p>
        </section>
        <section class="smallchart">
            <canvas id="deathChart"></canvas>
        </section>
    </section>

 
{% endblock content %}
 
{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<script>
    fetch(`https://covid19-api.org/api/timeline`)
            .then(res => res.json())
            .then(data => {
            var cases = []
            var labels = []
            var deaths = []
            var recovered = []
            var daily = []
            let n = 0;
            data.forEach(element => {
                cases.unshift(data[n].total_cases);
                let masno = data[n].last_update;
                let update = masno.replace("T", " ")
                labels.unshift(update)
                deaths.unshift(data[n].total_deaths)
                recovered.unshift(data[n].total_recovered)
                n++;
            });
            n--;
            document.getElementById("dailyRes").innerHTML = `Dzisiejsza liczba przypadków: ${cases[n] - cases[n-1]}`;
            document.getElementById("casesRes").innerHTML = `Łączna liczba przypadków: ${cases[n]}`;
            document.getElementById("deathRes").innerHTML = `Śmierci łącznie: ${deaths[n]}`;
            document.getElementById("recoveredRes").innerHTML = `Wyzdrowiałych łącznie: ${recovered[n]}`;
            for (n ; n > 0 ; n--) {
                let val = cases[n + 1] - cases[n];
                if (val < 0) {
                    val = -(val);
                }
                daily.unshift(val);
            }
            var myChart = document.getElementById("myChart").getContext('2d');
            var dailyChart = document.getElementById("dailyChart").getContext('2d');
            var deathChart = document.getElementById("deathChart").getContext('2d');
            var chart = new Chart(myChart, {
                type:'line',
                data:{
                    labels: labels,
                    datasets: [
                        {
                            label: "Potwierdzone przypadki",
                            data: cases,
                            backgroundColor: '#CE0217',
                            minBarLength: 100
                        }
                    ]
                },
                options:{}
            })
            var dailyCh = new Chart(dailyChart, {
                type:'line',
                data:{
                    labels: labels,
                    datasets: [
                        {
                            label: "Dzienne przypadki",
                            data: daily,
                            backgroundColor: '#3585CA',
                            minBarLength: 100
                        }
                    ]
                },
                options:{}
            })
            var deathCh = new Chart(deathChart, {
                type:'line',
                data:{
                    labels: labels,
                    datasets: [
                        {
                            label: "Ozdrowione przypadki",
                            data: recovered,
                            backgroundColor: '#32cd32',
                            minBarLength: 100
                        },

                        {
                            label: "Śmierci",
                            data: deaths,
                            backgroundColor: '#696969',
                            minBarLength: 100
                        }
                    ]
                },
                options:{}
            })
        });
</script>
{% endblock scripts %}